## 2.MS 升级 E3

```SQL
/********************************商品资料******************************************/
---导入颜色
  delete [E3_YHM_2022]..YANSE
  INSERT INTO YANSE(YSDM,YSMC)
  SELECT ysdm,ysmc from MS..yanse  where ysdm not in(select ysdm from [E3_YHM_2022]..yanse)
--尺码
  delete  [E3_YHM_2022]..chima
  INSERT INTO [E3_YHM_2022]..CHIMA(CMDM,CMMC,CWZ,LWZ,CMDZ)
  SELECT CMDM,CMMC,CWZ,LWZ,ZJF from MS..CHIMA  where CMDM not in(select CMDM from [E3_YHM_2022]..CHIMA)
  SELECT * FROM CHIMAZU
  --尺码组
  INSERT INTO [E3_YHM_2022]..CHIMAZU(CMZDM,CMZMC,TY)
  SELECT CMZDM,CMZMC,TY FROM MS..CHIMAZU
  --尺码组明细
  INSERT INTO [E3_YHM_2022]..CHIMAZUmx(CMZDM,CMDM)
  SELECT CMZDM,cmdm FROM MS..CHIMAZUMX
  --品牌
  delete [E3_YHM_2022]..PINPAI
  insert into [E3_YHM_2022]..PINPAI(PPDM,PPMC,BYZD1)
  select ppdm,ppmc,byzd1 from MS..PINPAI where PPDM not in(select PPDM from [E3_YHM_2022]..PINPAI)
  --大类
  delete [E3_YHM_2022]..DALEI
  insert into [E3_YHM_2022]..DALEI(DLDM,DLMC)
  select zldm,zlmc from MS..HPZL where ZLDM  not in(SELECT dldm from [E3_YHM_2022]..DALEI)
  --年份
  DELETE [E3_YHM_2022]..NIANFEN
  INSERT INTO [E3_YHM_2022]..NIANFEN(NFDM,NFMC)
  SELECT NFDM,NFMC FROM  MS..HPNF WHERE NFDM NOT IN(SELECT NFDM FROM [E3_YHM_2022]..NIANFEN)
  --季节
  DELETE [E3_YHM_2022]..JIJIE
  INSERT INTO [E3_YHM_2022]..JIJIE(JJDM,JJMC)
  SELECT JJDM,JJMC FROM MS..JIJIE WHERE JJDM NOT IN(SELECT JJDM FROM [E3_YHM_2022]..JIJIE)
  --款式
  DELETE [E3_YHM_2022]..SPSX1
  INSERT INTO [E3_YHM_2022]..SPSX1(SXDM,SXMC)
  SELECT KSDM,KSMC FROM MS..HPKS WHERE KSDM NOT IN(SELECT SXDM FROM [E3_YHM_2022]..SPSX1)
---导入资料
  delete [E3_YHM_2022]..HPXX
  INSERT INTO [E3_YHM_2022]..HPXX(HPDM,HPMC,ZJF,DLDM,JJDM,PPDM,NFDM,BYSX1,JJ,SJ,SJ1,SJ3,SJ4,TY,TJ,S_RQ,E_RQ,CJR,CJRQ,BYZD1,FJSX1,FJSX2,FJSX3,FJSX4,FJSX5,FJSX6,KCSX,KCXX  )
  SELECT  HPDM,HPMC,ZJF,'000','000','000','000','000',JJ,SJ1,SJ3,SJ,SJ2,TY,TJ,S_RQ,S_RQ,'sa',GETDATE(),BYZD1,FJSX1,FJSX2,FJSX3,FJSX4,FJSX5,FJSX6,KCSX,KCXX FROM MS..HPXX
  WHERE HPDM NOT IN(SELECT HPDM FROM [E3_YHM_2022]..HPXX)
  ---更新价格
  UPDATE  HPXX SET SJ5=0,SJ6=0,SJ7=0,SJ8=0,SJ9=0,SJ2=0

  ---导入颜色
  delete [E3_YHM_2022]..HPYS
  INSERT INTO [E3_YHM_2022]..HPYS(HPDM,YSDM)
  SELECT HPDM,YSDM FROM MS..HPYS WHERE  HPDM+YSDM NOT IN(SELECT HPDM+YSDM FROM HPYS) AND YSDM IN(SELECT YSDM FROM [E3_YHM_2022]..YANSE) AND HPDM IN(SELECT HPDM FROM [E3_YHM_2022]..HPXX)
---导入尺码
  delete [E3_YHM_2022]..hpcm
  INSERT INTO [E3_YHM_2022]..HPCM(HPDM,CMDM)
  SELECT HPDM,CMDM FROM MS..HPCM WHERE  HPDM+CMDM NOT IN(SELECT HPDM+CMDM FROM HPCM) AND CMDM IN(SELECT CMDM FROM [E3_YHM_2022]..CHIMA) AND HPDM IN(SELECT HPDM FROM [E3_YHM_2022]..HPXX)
---品牌
  UPDATE  A SET A.PPDM=B.PPDM FROM [E3_YHM_2022]..HPXX A,(SELECT  HPDM,B.PPDM FROM  MS..V_HPXX A ,[E3_YHM_2022]..PINPAI B WHERE  A.PPMC=B.PPMC) B WHERE A.HPDM=B.HPDM
---大类
  UPDATE  A SET A.DLDM=B.DLDM FROM [E3_YHM_2022]..HPXX A,(SELECT  HPDM,B.DLDM FROM  MS..V_HPXX A ,[E3_YHM_2022]..DALEI B WHERE  A.ZLMC=B.DLMC) B WHERE A.HPDM=B.HPDM
  --jijie
  UPDATE  A SET A.JJDM=B.JJDM FROM [E3_YHM_2022]..HPXX A,(SELECT  HPDM,B.JJDM FROM  MS..V_HPXX A ,[E3_YHM_2022]..JIJIE B WHERE  A.JJMC=B.JJMC) B WHERE A.HPDM=B.HPDM
--nianfen
  UPDATE  A SET A.NFDM=B.NFDM FROM [E3_YHM_2022]..HPXX A,(SELECT  HPDM,B.NFDM FROM  MS..V_HPXX A ,[E3_YHM_2022]..NIANFEN B WHERE  A.NFMC=B.NFMC) B WHERE A.HPDM=B.HPDM
---kuanse
  UPDATE  A SET A.bysx1=B.SXDM FROM [E3_YHM_2022]..HPXX A,(SELECT  HPDM,B.SXDM FROM  MS..V_HPXX A ,[E3_YHM_2022]..SPSX1 B WHERE  A.KSMC=B.SXMC) B WHERE A.HPDM=B.HPDM
/********************************销售资料*********************************************/
  ---员工
  delete [E3_YHM_2022]..YUANGONG
  insert into [E3_YHM_2022]..YUANGONG(YGDM,YGMC)
  values('000','未定义')
  --区域
  delete FROM MS..QUYU
  INSERT INTO QUYU(QYDM,QYMC,BYZD1)
  SELECT QYDM,QYMC,BYZD1 from  MS..QUYU
  ---供货商
  delete [E3_YHM_2022]..GHS
  INSERT INTO [E3_YHM_2022]..GHS(GHSDM,GHSMC,GHSLB,ZK,JG,TY,GHSXZ,BZ,CJR,CJRQ,DZ,YB,LXR,GDDH,SJBH,CZ,EMAIL,WZ,KHYH,ZHMC,ZH,FRDB)
  SELECT GHSDM,GHSMC,'000',ZK,'JJ',ty,'001','','SA',GETDATE(),DZ,YB,LXR,GDDH,SJ,CZ,EMAIL,WZ,KHYH,ZHMC,ZH,FRDB FROM  [MS]..GHS
  ---客户
  DELETE [E3_YHM_2022]..KEHU
  INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,DZ,YB,LXR,GDDH,SJBH,CZ,EMAIL,WZ,KHYH,ZHMC,ZH,FRDB,BZ,QYDM,ZK,TY,JG,YDT,PPQX,XYJE,CJR,CJRQ)
  SELECT KHDM,KHMC,ZJF,KHXZ,CKDM,'000','000',0,'000',DZ,YB,LXR,GDDH,SJ,CZ,EMAIL,WZ,KHYH,ZHMC,ZH,FRDB,BZ,QYDM,ZK,TY,byzd2,ydt,0,XYJE,'SA',GETDATE() FROM [MS]..KEHU WHERE KHDM NOT IN(SELECT KHDM FROM [E3_YHM_2022]..KEHU)
  UPDATE [E3_YHM_2022]..KEHU SET KHXZ='000'  WHERE KHXZ='0'
  UPDATE [E3_YHM_2022]..KEHU SET KHXZ='000'  WHERE KHXZ='1'
  UPDATE [E3_YHM_2022]..KEHU SET KHXZ='001'  WHERE KHXZ='2'
  UPDATE [E3_YHM_2022]..KEHU SET KHXZ='002'  WHERE KHXZ='3'
  --添加单子里面需要的客户
      INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,ZK,TY,JG,YDT,PPQX,CJR,CJRQ)
      VALUES('024','024','','000','','000','000',0,'000',1,0,'SJ1',0,0,'SA',GETDATE())
      INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,ZK,TY,JG,YDT,PPQX,CJR,CJRQ)
      VALUES('074','074','','000','','000','000',0,'000',1,0,'SJ1',0,0,'SA',GETDATE())
      INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,ZK,TY,JG,YDT,PPQX,CJR,CJRQ)
      VALUES('533','533','','000','','000','000',0,'000',1,0,'SJ1',0,0,'SA',GETDATE())
      INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,ZK,TY,JG,YDT,PPQX,CJR,CJRQ)
      VALUES('648','648','','000','','000','000',0,'000',1,0,'SJ1',0,0,'SA',GETDATE())
      INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,ZK,TY,JG,YDT,PPQX,CJR,CJRQ)
      VALUES('221','221','','000','','000','000',0,'000',1,0,'SJ1',0,0,'SA',GETDATE())
    INSERT INTO [E3_YHM_2022]..KEHU(KHDM,KHMC,ZJF,KHXZ,CKDM,QDDM,LBDM,KL,YGDM,ZK,TY,JG,YDT,PPQX,CJR,CJRQ)
      VALUES('086','086','','000','','000','000',0,'000',1,0,'SJ1',0,0,'SA',GETDATE())
  ---仓库
  DELETE [E3_YHM_2022]..CANGKU
  INSERT INTO [E3_YHM_2022]..CANGKU(CKDM,CKMC,ZJF,CKXZ,JGDM,ZK,TY,qydm,QDDM)
  select CKDM,CKMC,ZJF,CKXZ,'SJ',ZK,TY,'000','000' FROM [MS]..CANGKU WHERE CKDM NOT IN(SELECT CKDM FROM [E3_YHM_2022]..CANGKU )
  UPDATE [E3_YHM_2022]..CANGKU SET CKXZ='000'  WHERE CKXZ='1'
  UPDATE [E3_YHM_2022]..CANGKU SET CKXZ='001'  WHERE CKXZ='2'
  UPDATE [E3_YHM_2022]..CANGKU SET CKXZ='002'  WHERE CKXZ='3'
  ---店员
  DELETE [E3_YHM_2022]..DIANYUAN
  INSERT INTO [E3_YHM_2022]..DIANYUAN(DYDM,DYMC,DYXZ,GSSD,XGJG,DYZK,DYJE,TCBL,DXJE,CSRQ,RZRQ,LZRQ,DYDJ,TY,CJR,CJRQ)
  SELECT DYDM,DYMC,DYXZ,GSSD,0,1,0,0,0,CSRQ,RZRQ,RZRQ,0,ty,'sa',GETDATE() FROM [MS]..DIANYUAN  where DYDM not in(select DYDM from [E3_YHM_2022]..DIANYUAN )
/********************************进销存业务单据******************************************/
  DELETE [E3_YHM_2022]..CGRKDMX
  DELETE [E3_YHM_2022]..CGRKD
  DELETE [E3_YHM_2022]..CGCKDMX
  DELETE [E3_YHM_2022]..CGCKD
  ---入库
SELECT * FROM [E3_YHM_2022]..CGRKD
  INSERT INTO [E3_YHM_2022]..CGRKD(DJBH,RQ,CKDM,GHSDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,JG,BZ,YJZ,JZR,JZRQ)
  SELECT 'CG'+SUBSTRING(DJBH,3,18),RQ,CKDM,GHSDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,JG,BZ,YSP,SPR,RQ FROM [MS]..CGRKD
  INSERT INTO [E3_YHM_2022]..CGRKDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT 'CG'+SUBSTRING(DJBH,3,18),MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CGRKDMX WHERE DJBH  IN(SELECT DJBH FROM [E3_YHM_2022]..CGRKD)
  ---退货
  INSERT INTO [E3_YHM_2022]..CGCKD(DJBH,RQ,CKDM,GHSDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,JG,BZ,YSH,SHR,SHRQ)
  SELECT DJBH,RQ,CKDM,GHSDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,JG,BZ,YSP,SPR,RQ FROM [MS]..CGCKD
  INSERT INTO [E3_YHM_2022]..CGCKDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CGCKDMX
      --修改价格标志
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..CGRKD as B WHERE A.JGMC=B.JG
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..CGCKD as B WHERE A.JGMC=B.JG
  ---调拨
  DELETE [E3_YHM_2022]..SPDBDmx
  DELETE [E3_YHM_2022]..SPDBD
  DELETE [E3_YHM_2022]..SPDBTmx
  DELETE [E3_YHM_2022]..SPDBT
  SELECT * FROM MS..SPDBt
  SELECT * FROM CANGKU
  INSERT INTO [E3_YHM_2022]..SPDBD(DJBH,RQ,KHDM,CKDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ,BYZD1)
  SELECT DJBH,RQ,KHDM,CKDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,YSH,SHR,RQ,JG,BZ,BYZD1 FROM [MS]..SPDBD WHERE KHDM IN(SELECT KHDM FROM [E3_YHM_2022]..KEHU)
  INSERT INTO [E3_YHM_2022]..SPDBDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..SPDBDMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..SPDBD)
  ---调拨退
  INSERT INTO [E3_YHM_2022]..SPDBT(DJBH,RQ,KHDM,CKDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ,byzd1)
  SELECT DJBH,RQ,KHDM,CKDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,YSH,SHR,RQ,JG,BZ,byzd1 FROM [MS]..SPDBT WHERE KHDM IN(SELECT KHDM FROM [E3_YHM_2022]..KEHU)
  INSERT INTO [E3_YHM_2022]..SPDBTMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..SPDBTMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..SPDBT)
  --
  INSERT INTO [E3_YHM_2022]..SPDBT(DJBH,RQ,KHDM,CKDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ,byzd1)
  SELECT 'DT'+SUBSTRING(djbh,3,18),RQ,'037','000',ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,1,SPR,RQ,JG,BZ,byzd1 FROM [MS]..ckycd WHERE djbh in('YC201510270933230000','YC201705081020090000')
  INSERT INTO [E3_YHM_2022]..SPDBTMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT 'DT'+SUBSTRING(djbh,3,18),MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CKYCDMX  WHERE djbh in('YC201510270933230000','YC201705081020090000')
      --修改价格标志
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..SPDBD as B WHERE A.JGMC=B.JG
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..SPDBT as B WHERE A.JGMC=B.JG
  ---零售单
  SELECT * FROM ms..LSXHD where VIPDM!=''
  DELETE [E3_YHM_2022]..QTLSDMX
  DELETE [E3_YHM_2022]..QTLSD
  INSERT INTO [E3_YHM_2022]..QTLSD(DJBH,RQ,CKDM,KHDM,VIPDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,JG,BZ,DYDM,JFS)
  SELECT DJBH,RQ,KHDM,CKDM,VIPDM,A.ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,'SJ',A.BZ,DYDM,JFS FROM [MS]..LSXHD A
  INSERT INTO [E3_YHM_2022]..QTLSDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..LSXHDMX  WHERE  DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..QTLSD)
  ---付款单
  DELETE FROM POSJSFS
  INSERT INTO POSJSFS(JSDM,JSMC,ZL,CJR,CJRQ,TY,JFBL)
  SELECT jsdm,jsmc,zl,cjr,cjrq,TY,bl from MS..LSJSFS
  --修改ms零售付款单代码
    update MS..LSFKD set JSDM =a.JSDM from MS..LSJSFS as a  where a.JSMC=MS..LSFKD.JSFS
    --根据E3前台零售单添加结算单
  DELETE [E3_YHM_2022]..QTJSD
  --INSERT INTO [E3_YHM_2022]..QTJSD(DJBH,MXBH,JSDM,JSJE,ZLJE)
  --SELECT DJBH,1,'000',JE,0 FROM [E3_YHM_2022]..QTLSD WHERE YSH=1
  --根据MS付款单添加结算单
  INSERT INTO [E3_YHM_2022]..QTJSD (DJBH,MXBH,JSDM,JSJE,ZLJE,bz,BYZD1)
  SELECT djbh,ROW_NUMBER() OVER (ORDER BY NEWID()) AS mxbh,jsdm,je,zlje,bz,JSFS from MS..LSFKD AS A
  ---仓库调整单
  DELETE [E3_YHM_2022]..CKTZDMX
  DELETE [E3_YHM_2022]..CKTZD
  INSERT INTO [E3_YHM_2022]..CKTZD(DJBH,RQ,CKDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,JG,BZ)
  SELECT DJBH,RQ,CKDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,'SJ',BZ FROM [MS]..CKTZD
  INSERT INTO [E3_YHM_2022]..CKTZDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CKTZDMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..CKTZD)
  --仓库盘点单
  delete FROM [E3_YHM_2022]..CKPDDMX
  DELETE FROM [E3_YHM_2022]..CKPDD
    INSERT INTO [E3_YHM_2022]..CKPDD(DJBH,RQ,CKDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ)
  SELECT DJBH,RQ,CKDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,YSK,SKR,SKRQ,'SJ',BZ FROM [MS]..CKPDD
    INSERT INTO [E3_YHM_2022]..CKPDDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CKPDDMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..CKPDD)AND HPDM IN(SELECT HPDM FROM HPXX)

  --仓库盈亏单
    INSERT INTO [E3_YHM_2022]..CKYKD(DJBH,RQ,CKDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ)
  SELECT DJBH,RQ,CKDM,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,YSK,SKR,SKRQ,'SJ',BZ FROM [MS]..CKYKD
    INSERT INTO [E3_YHM_2022]..CKYKDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CKYKDMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..CKYKD)AND HPDM IN(SELECT HPDM FROM HPXX)
  ---仓库移仓单
  DELETE [E3_YHM_2022]..CKYCDMX
  DELETE [E3_YHM_2022]..CKYCD
  --仓库-仓库
  INSERT INTO [E3_YHM_2022]..CKYCD(DJBH,RQ,YRDM,YCDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ,YCXZ)
  SELECT DJBH,RQ,YRCK,YCCK,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,YSK,SKR,RQ,'SJ',BZ,'仓库-仓库' FROM [MS]..CKYCD where YRCK in(select ckdm from CANGKU where CKXZ='000') and YCCK in(select ckdm from CANGKU where CKXZ='000')
  --店铺-店铺
  INSERT INTO [E3_YHM_2022]..CKYCD(DJBH,RQ,YRDM,YCDM,ZK,ZDR,ZDRQ,SL,JE,YSH,SHR,SHRQ,YYS,YSR,YSRQ,JG,BZ,YCXZ)
  SELECT DJBH,RQ,YRCK,YCCK,ZK,ZDR,ZDRQ,SL,HPZE,YSP,SPR,RQ,YSK,SKR,RQ,'SJ',BZ,'店铺-店铺' FROM [MS]..CKYCD where YRCK in(select ckdm from CANGKU where CKXZ!='000') and YCCK in(select ckdm from CANGKU where CKXZ!='000')
  INSERT INTO [E3_YHM_2022]..CKYCDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..CKYCDMX  WHERE  djbh not in('YC201510270933230000','YC201705081020090000')
    --修改价格标志
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..CKPDD as B WHERE A.JGMC=B.JG
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..CKYKD as B WHERE A.JGMC=B.JG
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..CKTZD as B WHERE A.JGMC=B.JG
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..CKYCD as B WHERE A.JGMC=B.JG

  ---批发销货单
  DELETE [E3_YHM_2022]..PFXHDMX
  DELETE [E3_YHM_2022]..PFXHD
  INSERT INTO [E3_YHM_2022]..PFXHD(DJBH,RQ,CKDM,KHDM,GLDDBH,ZK,SL,JE,ZDR,ZDRQ,YSH,SHR,SHRQ,YYS,YSR,YSRQ,YJZ,JZR,JZRQ,JG,BZ,BYZD1,JSJE,JSR,JSRQ,YJS)
  SELECT DJBH,RQ,CKDM,KHDM,GLDDBH,ZK,SL,HPZE,ZDR,ZDRQ,YSP,SPR,SPRQ,YSP,SPR,SPRQ,YSP,SPR,SPRQ,JG,BZ,BYZD1,SKZE,SKR,SKRQ,YSK FROM [MS]..PFXHD
  INSERT INTO [E3_YHM_2022]..PFXHDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..PFXHDMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..PFXHD)
  --批发退货单
  DELETE [E3_YHM_2022]..PFTHDMX
  DELETE [E3_YHM_2022]..PFTHD
  INSERT INTO [E3_YHM_2022]..PFTHD(DJBH,RQ,CKDM,KHDM,GLDDBH,ZK,SL,JE,ZDR,ZDRQ,YSH,SHR,SHRQ,YYS,YSR,YSRQ,YJZ,JZR,JZRQ,JG,BZ,BYZD1)
  SELECT DJBH,RQ,CKDM,KHDM,GLDDBH,ZK,SL,HPZE,ZDR,ZDRQ,YSP,SPR,SPRQ,YSP,SPR,SPRQ,YSP,SPR,SPRQ,JG,BZ,BYZD1 FROM [MS]..PFTHD
  INSERT INTO [E3_YHM_2022]..PFTHDMX(DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ)
  SELECT DJBH,MXBH,HPDM,HPYS,HPCM,SL,DJ,ZK,SJDJ,JE,BZ FROM [MS]..PFTHDMX  WHERE DJBH IN(SELECT DJBH FROM [E3_YHM_2022]..PFTHD)
  --修改价格标志
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..PFXHD as B WHERE A.JGMC=B.JG
  update B  SET JG=A.JGDM FROM [E3_YHM_2022]..JIAGE  AS A,[E3_YHM_2022]..PFTHD as B WHERE A.JGMC=B.JG
/********************************客户往来业务单据******************************************/
  --应收款调整单
  SELECT *  FROM MS..YSKTZD
  DELETE [E3_YHM_2022]..YSKTZD
  INSERT INTO [E3_YHM_2022]..YSKTZD(DJBH,QDDM,KHDM,RQ,YDBH,TZLX,JE,ZDR,ZDRQ,YJZ,JZRQ,JZR,BYZD1)
  SELECT DJBH,'000',KHDM,RQ,YDBH,TZLX,JE,ZDR,ZDRQ,JSP,JSRQ,JSR,BZ FROM [MS]..YSKTZD
  DELETE [E3_YHM_2022]..YFKTZD
  INSERT INTO [E3_YHM_2022]..YFKTZD(DJBH,QDDM,GHSDM,RQ,YDBH,TZLX,JE,ZDR,ZDRQ,YJZ,JZRQ,JZR,BYZD1)
  SELECT DJBH,'000',GHSDM,RQ,YDBH,TZLX,JE,ZDR,ZDRQ,JSP,JSRQ,JSR,BZ FROM [MS]..YFKTZD
  --收款单
  DELETE [E3_YHM_2022]..KHSKD
  INSERT INTO [E3_YHM_2022]..KHSKD(DJBH,QDDM,KHDM,RQ,YDBH,SKLX,SCQK,JE,ZDR,ZDRQ,JZR,JZRQ,YJZ,BZ)
  SELECT DJBH,'000',KHDM,RQ,YDBH,TZLX,SCQK,JE,ZDR,ZDRQ,JSR,JSRQ,jsp,BZ FROM [MS]..KHSKD
  INSERT  INTO [E3_YHM_2022]..KHSKDMX1(DJBH,MXBH,YHDM,JE)
  select  DJBH,MXBH,JSFS,JE from ms..KHSKD
  --付款单
  DELETE [E3_YHM_2022]..GHSFKD
  INSERT INTO [E3_YHM_2022]..GHSFKD(DJBH,QDDM,GHSDM,RQ,YDBH,FKLX,SCYF,JE,ZDR,ZDRQ,JZR,JZRQ,YJZ,BZ)
  SELECT DJBH,'000',GHSDM,RQ,YDBH,TZLX,SCQK,JE,ZDR,ZDRQ,JSR,JSRQ,jsp,BZ FROM [MS]..GHSFKD
    INSERT  INTO [E3_YHM_2022]..GHSFKDMX1(DJBH,MXBH,YHDM,JE)
  select  DJBH,MXBH,JSFS,JE from ms..GHSFKD
  ----------------------------*****费用单*****--------------------------------------------
  --现金银行科目
  delete from XJYH
  DELETE FROM YHKM
  insert into [E3_YHM_2022]..XJYH(XJYHDM,XJYHMC,xz,JE,KHYH,YHZH,KHMC,BYZD1,BYZD2)
  select lxdm,lxmc,1,JE,KHYH,YHZH,KHXM,byzd1,BYZD2 from ms..jslx
  insert into [E3_YHM_2022]..YHKM(YHDM,YHMC,YHXZ,YHHM,KHYH,YHZH,JE)
  select lxdm,lxmc,1,'',KHYH,YHZH,JE from ms..jslx
  --删除费用相关单据
  DELETE FROM [E3_YHM_2022]..XSFYDMX
  DELETE FROM [E3_YHM_2022]..XSFYDMX1
  DELETE FROM [E3_YHM_2022]..XSFYD
  DELETE FROM FEIYONG
  --添加费用
  INSERT INTO [E3_YHM_2022]..FEIYONG(FYDM,FYMC,CJR,CJRQ,TY)
  SELECT FYDM,FYMC,'SA',GETDATE(),0 FROM MS..FEIYONG
  --费用单
  INSERT INTO [E3_YHM_2022]..XSFYD(DJBH,RQ,DJLX,KHDM,FYJE,YDBH,ZDR,ZDRQ,YSH,SHRQ,SHR,JZR,JZRQ,YJZ,BZ)
  SELECT DJBH,RQ,TZLX,KHDM,JE,YDBH,ZDR,ZDRQ,1,JSRQ,JSR,JSR,JSRQ,1,BZ  FROM MS..XHFYD
  --费用单费用明细
  INSERT INTO [E3_YHM_2022]..XSFYDMX(DJBH,MXBH,FYDM,FYJE)
  SELECT  DJBH,MXBH,FYDM,JE FROM MS..XHFYD
  --费用单收款方式明细
  UPDATE MS..XHFYD SET JSFS='000' WHERE DJBH='FY0000003069'
  INSERT INTO [E3_YHM_2022]..XSFYDMX1(DJBH,MXBH,YHDM,JE)
  SELECT  DJBH,MXBH,JSFS,JE FROM MS..XHFYD

/********************************会员资料单据******************************************/

  --1、导入VIP类别
INSERT INTO VIPLB(LBDM,LBMC,ZK,JFBL,LJJF,S_JF,E_JF,SRJFBL)
SELECT XZDM,XZMC,ZK,JF,0,0,0,0 FROM MS..VIPXZ

--2、导入VIP信息
INSERT INTO VIPSET (VIPDM,VIPMC,CSRQ,SJBH,GLSD,CJR,CJRQ,LJJF,DQJF,LJXFJE,DQJE,LBDM,QY,QYRQ,QYR,TY,TYRQ,TYR,PWD,VIPPWD,SEX)
SELECT VIPDM,VIPMC,CSRQ,SJ,GLSD,CJR,CJRQ,JF,JF,LJXFJE,CZJE,
(case VIPXZ when 'VIP' then '002' when '普通' then '001' else '001' end),0,QYRQ,QYR,TY,tyrq,tyr,PWD,vippwd,
(case vipsex when '女' then 1 when '男' THEN 2 ELSE 1 END) from MS..VIPSET
--3、修改积分调整的ydbh
update  MS..JFTZD set YDBH=0 where YDBH=''
--4、导入积分调整单
INSERT INTO VIPJFTZD(DJBH,RQ,KHDM,VIPDM,YDBH,TZLX,YJF,TZJF,ZDR,ZDRQ,YSH,SHR,SHRQ,BZ)
SELECT DJBH,RQ,KHDM,VIPDM,'',TZLX,cast(YDBH  as decimal(18,2)),JF,ZDR,ZDRQ,JSP,JSR,JSRQ,BZ FROM MS..JFTZD WHERE VIPDM IN(SELECT VIPDM FROM VIPSET  )
--5、根据积分记录表获取
SELECT VIPDM ,SUM(JFS) AS JF INTO #JF1 FROM VW_VIPJFJLB GROUP BY VIPDM
SELECT A.VIPDM,A.DQJF ,B.JF FROM VIPSET AS A ,#JF1 AS B WHERE A.VIPDM=B.VIPDM AND A.DQJF!=B.JF
--允许将显式值插入表的标识列中 ON-允许
set identity_insert jftzd ON
--导入积分调整单
INSERT INTO VIPJFTZD(DJBH,VIPDM,RQ,YDBH,TZLX,YJF,TZJF,ZDR,ZDRQ,YSH,SHR,SHRQ,KHDM,BZ)
SELECT 'JF'+right(cast('10000000000' as varchar)+ROW_NUMBER() OVER (ORDER BY NEWID()),10) AS DJBH,
a.VIPDM,'2020-07-01','','期初调整',0,a.DQJF,'SA',GETDATE(),1,'SA',GETDATE(),A.GLSD,A.BZ from VIPSET as a
WHERE A.DQJF!=0
INSERT INTO VIPJFTZD(DJBH,VIPDM,RQ,YDBH,TZLX,YJF,TZJF,ZDR,ZDRQ,YSH,SHR,SHRQ,KHDM,BZ)
SELECT 'JF'+right(cast('10000000650' as varchar)+ROW_NUMBER() OVER (ORDER BY NEWID()),10) AS DJBH,
a.VIPDM,'2020-07-01','','期初调整',B.JF,a.DQJF-B.JF,'SA',GETDATE(),1,'SA',GETDATE(),A.GLSD,A.BZ from VIPSET AS A ,#JF1 AS B WHERE A.VIPDM=B.VIPDM AND A.DQJF!=B.JF
--允许将显式值插入表的标识列中 OFF-关闭
set identity_insert jftzd OFF
--允许将显式值插入表的标识列中 ON-允许
set identity_insert VIPCZD ON
--导入会员储值单
INSERT INTO VIPCZD(DJBH,MXBH,VIPDM,RQ,YDBH,TZLX,CZJE,ZDR,ZDRQ,JSRQ,JSR,JSP,KHDM,BZ,zsje,sjje,ZSJF,DYDM)
SELECT 'CZ'+right(cast('10000000000' as varchar)+ROW_NUMBER() OVER (ORDER BY NEWID()),10) AS DJBH,ROW_NUMBER() OVER (ORDER BY NEWID()) as mxbh,
a.VIPDM,'2020-07-01',0,'一般充值',a.CZJE,'SA',GETDATE(),getdate(),'SA',1,A.GLSD,A.BZ,0,A.CZJE,0, '001' from VIPSET as a
WHERE A.CZJE >=0 OR A.CZJE<='0'
--允许将显式值插入表的标识列中 OFF-关闭
set identity_insert VIPCZD OFF
--导入会员储值单明细
INSERT INTO VIPCZDMX (DJBH ,MXBH,JSDM,JE)
SELECT DJBH,MXBH,'000',CZJE FROM VIPCZD

/***************************************系统管理******************************************/

--添加用户
INSERT INTO SYSTEM_USERS(USERID,USERNAME,PWD,TY,QX_PP,QX_GHS,QX_CK,QX_QY,QX_KH,QX_QD,QX_DL)
select YHDM,YHMC,YHMM,0,1,1,1,1,1,1,1 from ms..YONGHU WHERE YHDM NOT IN(SELECT USERID FROM SYSTEM_USERS)
--添加角色
DELETE FROM SYS_RULE
INSERT INTO SYS_RULE(RLID,RLNAME)
select YHDM,YHMC from ms..YONGHU
--角色权限，进系统设置；
--条码
delete FROM [E3_YHM_2022]..TMFA
INSERT INTO  [E3_YHM_2022]..TMFA
SELECT *FROM MS..TMFA
```

```
insert into hpys (hpdm,ysdm)
select hpdm,'01' from hpxx where hpdm+'01' not in(select hpdm+ysdm from hpys)
```
